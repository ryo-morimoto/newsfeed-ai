# .github/workflows/e2e-production.yml
name: E2E Production Smoke Tests

on:
  push:
    branches: [main]
    paths:
      - "apps/web/**"
      - ".github/workflows/e2e-production.yml"
  workflow_dispatch:

jobs:
  smoke-test:
    runs-on: ubuntu-latest
    timeout-minutes: 10
    steps:
      - uses: actions/checkout@v4

      - uses: oven-sh/setup-bun@v2
        with:
          bun-version: latest

      - name: Install dependencies
        run: bun install

      - name: Install Playwright browsers
        run: bunx playwright install chromium
        working-directory: apps/web

      - name: Wait for deployment
        run: sleep 30

      - name: Run smoke tests
        run: bun run test:e2e:smoke
        working-directory: apps/web
        env:
          E2E_BASE_URL: https://newsfeed-ai.ryo-o.dev

      - uses: actions/upload-artifact@v4
        if: failure()
        with:
          name: playwright-report
          path: apps/web/playwright-report/
          retention-days: 7
